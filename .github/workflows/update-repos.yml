name: Atualizar Repositórios Recentes

on:
  schedule:
    - cron: '0 0 * * *'  # Executa diariamente à meia-noite
  workflow_dispatch:      # Permite execução manual

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout do Repositório
        uses: actions/checkout@v4

      - name: Buscar Repositórios Recentes
        id: fetch-repos
        run: |
          RESPONSE=$(curl -s "https://api.github.com/users/luanmuzy/repos?sort=updated&per_page=15&type=all" | jq -r '.[] | select(.fork == false) | "- [\(.name)](\(.html_url))"')
          echo "repos<<EOF" >> $GITHUB_OUTPUT
          echo "$RESPONSE" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: Atualizar README
        run: |
          # Cria a seção de projetos
          SECTION="## 🚀 Projetos Recentes\n\n<!-- PROJECTS_START -->\n${{ steps.fetch-repos.outputs.repos }}\n<!-- PROJECTS_END -->"

          # Substitui no README.md
          sed -i "s|## 🚀 Projetos Recentes.*<!-- PROJECTS_END -->|$SECTION|" README.md

      - name: Commit e Push
        run: |
          git config --global user.name "Luã Muzy"
          git config --global user.email "luan.b.muzy@gmail.com"
          git add README.md
          git commit -m "🔄 Atualização automática de repositórios"
          git push
