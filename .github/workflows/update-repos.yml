name: Atualizar Reposit贸rios Recentes

on:
  schedule:
    - cron: '0 0 * * *'  # Executa diariamente  meia-noite
  workflow_dispatch:      # Permite execu莽茫o manual

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write    # Permiss茫o para fazer push no reposit贸rio

    steps:
      - name: Checkout do Reposit贸rio
        uses: actions/checkout@v4

      - name: Buscar Reposit贸rios Recentes
        id: fetch-repos
        run: |
          # Busca os 15 reposit贸rios mais recentes (excluindo forks)
          RESPONSE=$(curl -s "https://api.github.com/users/luanmuzy/repos?sort=updated&per_page=15&type=all")
          echo "repos=$RESPONSE" >> $GITHUB_OUTPUT

      - name: Processar e Atualizar README
        run: |
          # Instala o jq para manipular JSON
          sudo apt-get install -y jq

          # Cria a lista de reposit贸rios
          echo "${{ steps.fetch-repos.outputs.repos }}" | jq -r '.[] | select(.fork == false) | "- [\(.name)](\(.html_url))"' > repos.md

          # Insere no README.md
          sed -i '/<!-- PROJECTS_START -->/,/<!-- PROJECTS_END -->/{//!d}' README.md
          sed -i '/<!-- PROJECTS_START -->/r repos.md' README.md

      - name: Commit e Push
        run: |
          git config --global user.name "luanmuzy"
          git config --global user.email "luan.b.muzy@gmail.com.com"
          git add README.md
          git commit -m " Atualiza莽茫o autom谩tica de reposit贸rios"
          git push
